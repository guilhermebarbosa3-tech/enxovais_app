# Estoque Exonvais ‚Äî Esqueleto v1

Estrutura modular multipage (Streamlit) com SQLite e stubs essenciais. Copie os arquivos para um reposit√≥rio com a mesma √°rvore. Rode com `streamlit run app.py`.

---

## √Årvore do projeto

```
estoque_exonvais/
‚îú‚îÄ app.py
‚îú‚îÄ pages/
‚îÇ  ‚îú‚îÄ 01_Clientes.py
‚îÇ  ‚îú‚îÄ 02_Produtos_Comuns.py
‚îÇ  ‚îú‚îÄ 03_Encomendas_Sob_Medida.py
‚îÇ  ‚îú‚îÄ 04_Status__Pedidos.py
‚îÇ  ‚îú‚îÄ 05_Status__Aguardando_Confeccao.py
‚îÇ  ‚îú‚îÄ 06_Status__Pedidos_em_Estoque.py
‚îÇ  ‚îú‚îÄ 07_Status__Nao_Conformes.py
‚îÇ  ‚îú‚îÄ 08_Financeiro.py
‚îÇ  ‚îî‚îÄ 09_Relatorios.py
‚îú‚îÄ core/
‚îÇ  ‚îú‚îÄ db.py
‚îÇ  ‚îú‚îÄ models.py
‚îÇ  ‚îú‚îÄ audit.py
‚îÇ  ‚îú‚îÄ storage.py
‚îÇ  ‚îî‚îÄ validators.py
‚îú‚îÄ services/
‚îÇ  ‚îú‚îÄ exporter.py
‚îÇ  ‚îú‚îÄ messenger.py
‚îÇ  ‚îú‚îÄ payments.py
‚îÇ  ‚îî‚îÄ quality.py
‚îú‚îÄ ui/
‚îÇ  ‚îú‚îÄ components.py
‚îÇ  ‚îî‚îÄ status_badges.py
‚îú‚îÄ uploads/
‚îú‚îÄ assets/
‚îú‚îÄ requirements.txt
‚îî‚îÄ README.md
```

---

## requirements.txt

```txt
streamlit==1.39.0
pillow==10.4.0
python-dateutil==2.9.0.post0
```

---

## app.py

```python
import streamlit as st
from core.db import init_db, get_conn
from core.models import OrderStatus

st.set_page_config(page_title="Estoque Exonvais", page_icon="üßµ", layout="wide")

init_db()

st.title("üßµ Estoque Exonvais ‚Äî Dashboard")

# KPIs simples (stub)
conn = get_conn()
cur = conn.cursor()
cur.execute("SELECT COUNT(*) FROM orders WHERE status=?", (OrderStatus.CRIADO,))
criadas = cur.fetchone()[0]
cur.execute("SELECT COUNT(*) FROM orders WHERE status=?", (OrderStatus.AGUARDANDO_CONF,))
aguard = cur.fetchone()[0]
cur.execute("SELECT COUNT(*) FROM orders WHERE status=?", (OrderStatus.EM_ESTOQUE,))
estoque = cur.fetchone()[0]

col1, col2, col3 = st.columns(3)
col1.metric("Pedidos Criados", criadas)
col2.metric("Aguardando Confec√ß√£o", aguard)
col3.metric("Em Estoque", estoque)

st.info("Use o menu 'pages' √† esquerda para navegar pelas fases.")
```

---

## core/models.py

```python
from dataclasses import dataclass
from typing import Optional

class OrderStatus:
    CRIADO = "CRIADO"
    ENVIADO_FORNECEDOR = "ENVIADO_FORNECEDOR"
    AGUARDANDO_CONF = "AGUARDANDO_CONF"
    RECEBIDO_CONF = "RECEBIDO_CONF"
    RECEBIDO_NC = "RECEBIDO_NC"
    EM_ESTOQUE = "EM_ESTOQUE"
    ENTREGUE = "ENTREGUE"
    FINALIZADO_FIN = "FINALIZADO_FIN"

@dataclass
class Client:
    id: Optional[int]
    name: str
    address: str
    cpf: str
    phone: str
    status: str  # ADIMPLENTE | INADIMPLENTE
```

---

## core/db.py

```python
import sqlite3, json, os, datetime
from typing import Any, Dict

DB_PATH = os.path.join(os.path.dirname(__file__), "..", "exonvais.db")
DB_PATH = os.path.abspath(DB_PATH)

SCHEMA_SQL = r"""
PRAGMA journal_mode=WAL;

CREATE TABLE IF NOT EXISTS clients (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  name TEXT NOT NULL,
  address TEXT,
  cpf TEXT,
  phone TEXT,
  status TEXT DEFAULT 'ADIMPLENTE'
);

CREATE TABLE IF NOT EXISTS product_catalog (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  category TEXT NOT NULL,
  type TEXT NOT NULL,
  product TEXT NOT NULL,
  measure_based INTEGER DEFAULT 0
);

CREATE TABLE IF NOT EXISTS orders (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  client_id INTEGER NOT NULL,
  category TEXT NOT NULL,
  type TEXT NOT NULL,
  product TEXT NOT NULL,
  price_cost REAL NOT NULL,
  price_sale REAL NOT NULL,
  notes_struct TEXT DEFAULT '{}',
  notes_free TEXT DEFAULT '',
  photos TEXT DEFAULT '[]',
  status TEXT NOT NULL,
  created_at TEXT NOT NULL,
  updated_at TEXT NOT NULL,
  FOREIGN KEY(client_id) REFERENCES clients(id)
);

CREATE TABLE IF NOT EXISTS shipments (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  order_id INTEGER NOT NULL,
  medium TEXT,
  when_ts TEXT NOT NULL,
  document_path TEXT,
  FOREIGN KEY(order_id) REFERENCES orders(id)
);

CREATE TABLE IF NOT EXISTS nonconformities (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  order_id INTEGER NOT NULL,
  kind TEXT NOT NULL,
  description TEXT,
  photos TEXT DEFAULT '[]',
  count INTEGER DEFAULT 1,
  created_at TEXT NOT NULL,
  FOREIGN KEY(order_id) REFERENCES orders(id)
);

CREATE TABLE IF NOT EXISTS finance_entries (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  order_id INTEGER NOT NULL,
  cost REAL NOT NULL,
  sale REAL NOT NULL,
  margin REAL NOT NULL,
  settled INTEGER DEFAULT 0,
  batch_id INTEGER,
  created_at TEXT NOT NULL,
  FOREIGN KEY(order_id) REFERENCES orders(id)
);

CREATE TABLE IF NOT EXISTS payment_batches (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  total REAL NOT NULL,
  created_at TEXT NOT NULL
);

CREATE TABLE IF NOT EXISTS audit_log (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  entity TEXT NOT NULL,
  entity_id INTEGER NOT NULL,
  action TEXT NOT NULL,
  field TEXT,
  before TEXT,
  after TEXT,
  user TEXT,
  ts TEXT NOT NULL
);
"""

_conn = None

def get_conn():
    global _conn
    if _conn is None:
        _conn = sqlite3.connect(DB_PATH, check_same_thread=False)
    _conn.row_factory = sqlite3.Row
    return _conn


def init_db():
    conn = get_conn()
    conn.executescript(SCHEMA_SQL)
    conn.commit()


def now_iso() -> str:
    return datetime.datetime.utcnow().isoformat()


def to_json(obj):
    return json.dumps(obj, ensure_ascii=False)


def from_json(txt, default):
    try:
        return json.loads(txt) if txt else default
    except Exception:
        return default


def audit(entity: str, entity_id: int, action: str, field: str = None, before: Any = None, after: Any = None, user: str = "system"):
    conn = get_conn()
    conn.execute(
        "INSERT INTO audit_log(entity, entity_id, action, field, before, after, user, ts) VALUES (?,?,?,?,?,?,?,?)",
        (entity, entity_id, action, field, to_json(before) if before is not None else None, to_json(after) if after is not None else None, user, now_iso())
    )
    conn.commit()
```

---

## core/audit.py

```python
from .db import audit as audit_insert

def log_change(entity, entity_id, action, field=None, before=None, after=None, user="system"):
    audit_insert(entity, entity_id, action, field, before, after, user)
```

---

## core/storage.py

```python
import os
from PIL import Image
from .db import to_json

BASE_UPLOAD = os.path.abspath(os.path.join(os.path.dirname(__file__), "..", "uploads"))
os.makedirs(BASE_UPLOAD, exist_ok=True)

def save_and_resize(img_file, filename_base: str, max_w: int = 1200):
    """img_file: streamlit UploadedFile; retorna caminho salvo."""
    img = Image.open(img_file)
    w, h = img.size
    if w > max_w:
        ratio = max_w / float(w)
        img = img.resize((max_w, int(h * ratio)))
    fname = f"{filename_base}.jpg"
    path = os.path.join(BASE_UPLOAD, fname)
    img.save(path, format="JPEG", quality=85)
    return path
```

---

## core/validators.py

```python
from typing import Dict

def validate_prices(cost: float, sale: float) -> None:
    assert cost is not None and sale is not None, "Pre√ßos obrigat√≥rios"
    assert cost >= 0 and sale >= 0, "Pre√ßos inv√°lidos"
```

---

## ui/status_badges.py

```python
import streamlit as st
from core.models import OrderStatus

def badge(status: str):
    color = {
        OrderStatus.CRIADO: "gray",
        OrderStatus.ENVIADO_FORNECEDOR: "blue",
        OrderStatus.AGUARDANDO_CONF: "blue",
        OrderStatus.RECEBIDO_CONF: "green",
        OrderStatus.RECEBIDO_NC: "red",
        OrderStatus.EM_ESTOQUE: "purple",
        OrderStatus.ENTREGUE: "green",
        OrderStatus.FINALIZADO_FIN: "green",
    }.get(status, "gray")
    st.markdown(f"<span style='padding:4px 8px;border-radius:999px;background:{color};color:white;font-size:12px'>{status}</span>", unsafe_allow_html=True)
```

---

## ui/components.py

```python
import streamlit as st

def section(title: str):
    st.subheader(title)
    st.divider()

def confirm_dialog(label: str) -> bool:
    return st.checkbox(label, value=False, key=f"confirm_{label}")


def photo_uploader(label: str, accept_multiple=True):
    return st.file_uploader(label, type=["jpg","jpeg","png"], accept_multiple_files=accept_multiple)
```

---

## services/exporter.py (stub)

```python
# TODO: gerar PDF/arquivo de pedido para fornecedor
# Recebe pedido + fotos e cria um PDF. Retorna caminho.

def export_order_pdf(order_row) -> str:
    return ""  # implementar
```

---

## services/messenger.py (stub)

```python
# TODO: integrar com API/URL-deeplink do WhatsApp (ou exibir QR/link)

def share_via_whatsapp(text: str):
    pass
```

---

## services/payments.py

```python
from core.db import get_conn

def create_payment_batch(order_ids: list[int]) -> int:
    conn = get_conn()
    cur = conn.cursor()
    # soma custos
    qmarks = ",".join(["?"]*len(order_ids))
    cur.execute(f"SELECT SUM(cost) FROM finance_entries WHERE order_id IN ({qmarks}) AND settled=0", order_ids)
    total = cur.fetchone()[0] or 0.0
    cur.execute("INSERT INTO payment_batches(total, created_at) VALUES (?, datetime('now'))", (total,))
    batch_id = cur.lastrowid
    cur.execute(f"UPDATE finance_entries SET settled=1, batch_id=? WHERE order_id IN ({qmarks}) AND settled=0", [batch_id, *order_ids])
    conn.commit()
    return batch_id
```

---

## services/quality.py (stub)

```python
# Helpers de N√£o Conformidade (estat√≠sticas, reincid√™ncia)
```

---

## pages/01_Clientes.py

```python
import streamlit as st
from core.db import get_conn
from ui.components import section

st.title("Clientes")
conn = get_conn()

with st.form("novo_cliente"):
    name = st.text_input("Nome")
    address = st.text_input("Endere√ßo")
    cpf = st.text_input("CPF")
    phone = st.text_input("Telefone")
    status = st.selectbox("Status", ["ADIMPLENTE","INADIMPLENTE"])
    if st.form_submit_button("Salvar"):
        conn.execute("INSERT INTO clients(name,address,cpf,phone,status) VALUES (?,?,?,?,?)", (name,address,cpf,phone,status))
        conn.commit()
        st.success("Cliente salvo")

section("Lista")
rows = conn.execute("SELECT * FROM clients ORDER BY id DESC").fetchall()
for r in rows:
    st.write(f"#{r['id']} ‚Äî {r['name']} ({r['status']})")
```

---

## pages/02_Produtos_Comuns.py

```python
import streamlit as st
from core.db import get_conn, now_iso, to_json
from core.models import OrderStatus
from core.validators import validate_prices
from ui.components import section, photo_uploader

st.title("Produtos Comuns ‚Äî Novo Pedido")
conn = get_conn()

clients = conn.execute("SELECT id, name FROM clients ORDER BY name").fetchall()
client_map = {f"{c['name']} (#{c['id']})": c['id'] for c in clients}

with st.form("pedido_comum"):
    client_sel = st.selectbox("Cliente", list(client_map.keys()))
    category = st.text_input("Categoria (ex: Len√ßol)")
    type_ = st.text_input("Tipo (ex: Solteiro/Casal)")
    product = st.text_input("Produto (ex: 3 pe√ßas, box, vi√∫va)")
    price_cost = st.number_input("Pre√ßo de custo", min_value=0.0, step=1.0)
    price_sale = st.number_input("Pre√ßo de venda", min_value=0.0, step=1.0)
    tecido = st.text_input("Tecido")
    cor = st.text_input("Cor")
    acabamento = st.text_input("Acabamento")
    obs_livre = st.text_area("Observa√ß√µes livres")
    fotos = photo_uploader("Fotos (m√∫ltiplas)")
    if st.form_submit_button("Concluir Pedido"):
        validate_prices(price_cost, price_sale)
        notes_struct = {"tecido":tecido, "cor":cor, "acabamento":acabamento}
        photos_paths = []  # TODO: salvar via storage
        conn.execute(
            """
            INSERT INTO orders(client_id, category, type, product, price_cost, price_sale, notes_struct, notes_free, photos, status, created_at, updated_at)
            VALUES (?,?,?,?,?,?,?,?,?,?,?,?)
            """,
            (client_map[client_sel], category, type_, product, price_cost, price_sale, to_json(notes_struct), obs_livre, to_json(photos_paths), OrderStatus.CRIADO, now_iso(), now_iso())
        )
        conn.commit()
        st.success("Pedido criado e enviado para Status > Pedidos")
```

---

## pages/03_Encomendas_Sob_Medida.py

```python
import streamlit as st
from core.db import get_conn, now_iso, to_json
from core.models import OrderStatus
from core.validators import validate_prices
from ui.components import section, photo_uploader

st.title("Encomendas Sob Medida ‚Äî Novo Pedido")
conn = get_conn()
clients = conn.execute("SELECT id, name FROM clients ORDER BY name").fetchall()
client_map = {f"{c['name']} (#{c['id']})": c['id'] for c in clients}

with st.form("pedido_medida"):
    client_sel = st.selectbox("Cliente", list(client_map.keys()))
    category = st.text_input("Categoria")
    type_ = st.text_input("Tipo")
    product = st.text_input("Produto")
    price_cost = st.number_input("Pre√ßo de custo", min_value=0.0, step=1.0)
    price_sale = st.number_input("Pre√ßo de venda", min_value=0.0, step=1.0)
    medidas = st.text_area("Medidas e detalhes (estruturado)")
    obs_livre = st.text_area("Observa√ß√µes livres")
    fotos = photo_uploader("Fotos (m√∫ltiplas)")
    if st.form_submit_button("Concluir Pedido"):
        validate_prices(price_cost, price_sale)
        notes_struct = {"medidas": medidas}
        photos_paths = []  # TODO: salvar via storage
        conn.execute(
            """
            INSERT INTO orders(client_id, category, type, product, price_cost, price_sale, notes_struct, notes_free, photos, status, created_at, updated_at)
            VALUES (?,?,?,?,?,?,?,?,?,?,?,?)
            """,
            (client_map[client_sel], category, type_, product, price_cost, price_sale, to_json(notes_struct), obs_livre, to_json(photos_paths), OrderStatus.CRIADO, now_iso(), now_iso())
        )
        conn.commit()
        st.success("Pedido criado e enviado para Status > Pedidos")
```

---

## pages/04_Status__Pedidos.py

```python
import streamlit as st
from core.db import get_conn, now_iso
from core.models import OrderStatus
from ui.status_badges import badge

st.title("Status ‚Ä¢ Pedidos")
conn = get_conn()

rows = conn.execute("SELECT o.*, c.name AS client_name FROM orders o JOIN clients c ON c.id=o.client_id WHERE o.status=? ORDER BY o.id DESC", (OrderStatus.CRIADO,)).fetchall()

for r in rows:
    with st.expander(f"#{r['id']} ‚Äî {r['client_name']} ‚Ä¢ {r['category']}/{r['type']}/{r['product']}"):
        cols = st.columns([1,1,1])
        with cols[0]:
            st.write(f"Custo: R$ {r['price_cost']:.2f}")
            st.write(f"Venda: R$ {r['price_sale']:.2f}")
        with cols[1]:
            badge(r['status'])
        if st.button("Compartilhar p/ fornecedor", key=f"send_{r['id']}"):
            conn.execute("UPDATE orders SET status=?, updated_at=? WHERE id=?", (OrderStatus.AGUARDANDO_CONF, now_iso(), r['id']))
            conn.commit()
            st.success("Pedido enviado e movido para 'Aguardando Confec√ß√£o'")
```

---

## pages/05_Status__Aguardando_Confeccao.py

```python
import streamlit as st
from core.db import get_conn, now_iso
from core.models import OrderStatus

st.title("Status ‚Ä¢ Aguardando Confec√ß√£o")
conn = get_conn()
rows = conn.execute("SELECT o.*, c.name AS client_name FROM orders o JOIN clients c ON c.id=o.client_id WHERE o.status=? ORDER BY o.id DESC", (OrderStatus.AGUARDANDO_CONF,)).fetchall()

for r in rows:
    with st.expander(f"#{r['id']} ‚Äî {r['client_name']} ‚Ä¢ {r['category']}/{r['type']}/{r['product']}"):
        c1, c2 = st.columns(2)
        if c1.button("Chegou conforme", key=f"ok_{r['id']}"):
            conn.execute("UPDATE orders SET status=?, updated_at=? WHERE id=?", (OrderStatus.EM_ESTOQUE, now_iso(), r['id']))
            conn.commit()
            st.success("Movido para 'Pedidos em Estoque'")
        if c2.button("Chegou n√£o conforme", key=f"nc_{r['id']}"):
            conn.execute("UPDATE orders SET status=?, updated_at=? WHERE id=?", (OrderStatus.RECEBIDO_NC, now_iso(), r['id']))
            conn.commit()
            st.warning("Movido para 'N√£o Conformes'")
```

---

## pages/06_Status__Pedidos_em_Estoque.py

```python
import streamlit as st
from core.db import get_conn, now_iso
from core.models import OrderStatus

st.title("Status ‚Ä¢ Pedidos em Estoque")
conn = get_conn()
rows = conn.execute("SELECT o.*, c.name AS client_name FROM orders o JOIN clients c ON c.id=o.client_id WHERE o.status=? ORDER BY o.id DESC", (OrderStatus.EM_ESTOQUE,)).fetchall()

for r in rows:
    with st.expander(f"#{r['id']} ‚Äî {r['client_name']} ‚Ä¢ {r['category']}/{r['type']}/{r['product']}"):
        st.write(f"Custo atual: R$ {r['price_cost']:.2f} ‚Äî Venda atual: R$ {r['price_sale']:.2f}")
        edit = st.checkbox("Alterar valores antes de concluir?", key=f"edit_{r['id']}")
        new_cost, new_sale = r['price_cost'], r['price_sale']
        if edit:
            new_cost = st.number_input("Novo custo", value=float(r['price_cost']), key=f"ncost_{r['id']}")
            new_sale = st.number_input("Nova venda", value=float(r['price_sale']), key=f"nsale_{r['id']}")
        if st.button("Concluir Entrega", key=f"done_{r['id']}"):
            if edit:
                conn.execute("UPDATE orders SET price_cost=?, price_sale=?, updated_at=? WHERE id=?", (new_cost, new_sale, now_iso(), r['id']))
            # cria lan√ßamento financeiro
            margin = (new_sale or 0.0) - (new_cost or 0.0)
            conn.execute("INSERT INTO finance_entries(order_id, cost, sale, margin, settled, created_at) VALUES (?,?,?,?,0, datetime('now'))", (r['id'], new_cost, new_sale, margin))
            conn.execute("UPDATE orders SET status=?, updated_at=? WHERE id=?", (OrderStatus.ENTREGUE, now_iso(), r['id']))
            conn.commit()
            st.success("Entrega conclu√≠da e lan√ßamento financeiro criado")
```

---

## pages/07_Status__Nao_Conformes.py

```python
import streamlit as st
from core.db import get_conn, now_iso
from core.models import OrderStatus

st.title("Status ‚Ä¢ N√£o Conformes")
conn = get_conn()
rows = conn.execute("SELECT o.*, c.name AS client_name FROM orders o JOIN clients c ON c.id=o.client_id WHERE o.status=? ORDER BY o.id DESC", (OrderStatus.RECEBIDO_NC,)).fetchall()

for r in rows:
    with st.expander(f"#{r['id']} ‚Äî {r['client_name']} ‚Ä¢ {r['category']}/{r['type']}/{r['product']}"):
        kind = st.selectbox("Tipo de NC", ["medida","tecido","cor","acabamento","outro"], key=f"kind_{r['id']}")
        desc = st.text_area("Descri√ß√£o", key=f"desc_{r['id']}")
        if st.button("Informar e reenviar ao fornecedor", key=f"send_{r['id']}"):
            conn.execute("INSERT INTO nonconformities(order_id, kind, description, photos, created_at) VALUES (?,?,?,?, datetime('now'))", (r['id'], kind, desc, "[]"))
            conn.execute("UPDATE orders SET status=?, updated_at=? WHERE id=?", (OrderStatus.AGUARDANDO_CONF, now_iso(), r['id']))
            conn.commit()
            st.success("NC registrada e pedido retornou para 'Aguardando Confec√ß√£o'")
```

---

## pages/08_Financeiro.py

```python
import streamlit as st
from core.db import get_conn
from services.payments import create_payment_batch
from core.models import OrderStatus

st.title("Financeiro")
conn = get_conn()
rows = conn.execute("SELECT f.*, o.id AS order_id, o.category, o.type, o.product, c.name AS client_name FROM finance_entries f JOIN orders o ON o.id=f.order_id JOIN clients c ON c.id=o.client_id WHERE f.settled=0 ORDER BY f.id DESC").fetchall()

sel = []
for r in rows:
    with st.expander(f"Pedido #{r['order_id']} ‚Äî {r['client_name']} | {r['category']}/{r['type']}/{r['product']}"):
        st.write(f"Custo: R$ {r['cost']:.2f} | Venda: R$ {r['sale']:.2f} | Margem: R$ {r['margin']:.2f}")
        if st.checkbox("Incluir no pagamento", key=f"pick_{r['id']}"):
            sel.append(r['order_id'])

if st.button("Pagar fornecedor (criar lote)") and sel:
    batch_id = create_payment_batch(sel)
    st.success(f"Lote #{batch_id} criado. Valores quitados.")
```

---

## pages/09_Relatorios.py

```python
import streamlit as st
from core.db import get_conn

st.title("Relat√≥rios")
conn = get_conn()
# Stubs simples de contagem
criadas = conn.execute("SELECT COUNT(*) FROM orders").fetchone()[0]
finalizadas = conn.execute("SELECT COUNT(*) FROM orders WHERE status='FINALIZADO_FIN'").fetchone()[0]

st.write(f"Total de pedidos: {criadas}")
st.write(f"Finalizados (financeiro): {finalizadas}")
```

---

## README.md (trecho)

````md
# Estoque Exonvais (Esqueleto)

## Rodar
```bash
pip install -r requirements.txt
streamlit run app.py
````

## Fluxo (Mermaid ‚Äî simplificado)

```mermaid
graph TD
  A(CRIADO) --> B(AGUARDANDO_CONF)
  B -->|Chegou conforme| C(EM_ESTOQUE)
  B -->|N√£o conforme| D(RECEBIDO_NC)
  D --> B
  C -->|Concluir Entrega| E(ENTREGUE)
  E --> F(FINALIZADO_FIN)
```

```

---

## Prompts curtos (Copilot) ‚Äî por arquivo

> Cole no topo do arquivo aberto no VS Code quando quiser que o Copilot complemente.

**/core/storage.py**
```

Copilot, implemente save de m√∫ltiplas fotos: receber lista de UploadedFile, salvar redimensionadas (1200px), retornar lista de caminhos. Crie tamb√©m um helper para marcar uma foto como principal.

```

**/pages/02_Produtos_Comuns.py**
```

Copilot, finalize o salvamento das fotos usando core.storage; inclua pr√©-visualiza√ß√£o em miniaturas; valide campos obrigat√≥rios; extraia o form para uma fun√ß√£o reutiliz√°vel.

```

**/pages/03_Encomendas_Sob_Medida.py**
```

Copilot, replique a l√≥gica de upload m√∫ltiplo + preview; adicione campos estruturados de medidas (largura, altura, profundidade) e grave no notes_struct.

```

**/pages/04_Status__Pedidos.py**
```

Copilot, adicione a√ß√µes Editar/Excluir com auditoria (core.audit.log_change); crie exporta√ß√£o em PDF (services.exporter) e registre em shipments.

```

**/pages/05_Status__Aguardando_Confeccao.py**
```

Copilot, mostre fotos e observa√ß√µes no expander; adicione confirma√ß√£o modal antes de mudar status; registre auditoria da transi√ß√£o.

```
```

**/pages/06_Status__Pedidos_em_Estoque.py**

```
Copilot, se alterar pre√ßos, registre auditoria campo-a-campo; ap√≥s concluir entrega, ofere√ßa bot√£o para abrir o pedido no Financeiro.
```

**/pages/07_Status__Nao_Conformes.py**

```
Copilot, permita anexar fotos de evid√™ncia; incremente contagem de reincid√™ncia por order_id; gere documento PDF de NC para envio.
```

**/pages/08_Financeiro.py**

```
Copilot, adicione tela de simula√ß√£o (totais, margem, contagem) antes de criar lote; permitir filtrar por per√≠odo.
```

**/pages/09_Relatorios.py**

```
Copilot, gere relat√≥rios por per√≠odo: pedidos por estado, margem por categoria, tempo m√©dio de confec√ß√£o e de retorno de NC.
```

